{"version":3,"sources":["index.js"],"names":["Signature","props","style","width","height","msTouchAction","touchAction","clearVal","handleMouseDown","bind","handleMouseMove","handleMouseUp","handleTouchStart","handleTouchMove","handleTouchEnd","strokeBegin","strokeUpdate","strokeEnd","transformData","createPoint","addPoint","calculateCurveWidths","drawPoint","drawCurve","drawDot","clear","reset","fromDataURL","document","addEventListener","velocityFilterWeight","minWidth","maxWidth","throttle","strokeMoveUpdate","dotSize","penColor","backgroundColor","mimeType","blob","trim","quality","canvas","offsetWidth","offsetHeight","ctx","getContext","nextProps","removeEventListener","dataUrl","options","callback","image","Image","ratio","window","devicePixelRatio","onload","drawImage","onerror","error","src","event","button","mouseButtonDown","targetTouches","length","touch","changedTouches","preventDefault","wasCanvasTouched","target","data","push","onBegin","x","clientX","y","clientY","point","curve","widths","start","end","time","canDrawCurve","points","onEnd","type","String","toLowerCase","toDataURL","byteString","atob","split","mimeString","array","Uint8Array","i","charCodeAt","Blob","rect","getBoundingClientRect","Point","left","top","Date","getTime","tmp","unshift","c2","c3","c1","Bezier","shift","startPoint","endPoint","velocity","velocityFrom","lastVelocity","newWidth","strokeWidth","lastWidth","Math","max","size","moveTo","arc","PI","onChange","startWidth","endWidth","widthDelta","drawSteps","floor","beginPath","t","tt","ttt","u","uu","uuu","control1","control2","closePath","fill","fillStyle","clearRect","fillRect","className","React","Component"],"mappings":"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","file":"index.js","sourcesContent":["import React from 'react';\nimport Point from './point';\nimport Bezier from './bezier';\nimport { calculateCurveControlPoints, throttle, trim } from './util';\n\nclass Signature extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.style = this.props.style || {};\n    this.style.width = this.style.width || '100%';\n    this.style.height = this.style.height || '100%';\n    this.style.msTouchAction = 'none';\n    this.style.touchAction = 'none';\n    this.clearVal = 0;\n\n    this.handleMouseDown = this.handleMouseDown.bind(this);\n    this.handleMouseMove = this.handleMouseMove.bind(this);\n    this.handleMouseUp = this.handleMouseUp.bind(this);\n    this.handleTouchStart = this.handleTouchStart.bind(this);\n    this.handleTouchMove = this.handleTouchMove.bind(this);\n    this.handleTouchEnd = this.handleTouchEnd.bind(this);\n    this.strokeBegin = this.strokeBegin.bind(this);\n    this.strokeUpdate = this.strokeUpdate.bind(this);\n    this.strokeEnd = this.strokeEnd.bind(this);\n    this.transformData = this.transformData.bind(this);\n    this.createPoint = this.createPoint.bind(this);\n    this.addPoint = this.addPoint.bind(this);\n    this.calculateCurveWidths = this.calculateCurveWidths.bind(this);\n    this.drawPoint = this.drawPoint.bind(this);\n    this.drawCurve = this.drawCurve.bind(this);\n    this.drawDot = this.drawDot.bind(this);\n    this.clear = this.clear.bind(this);\n    this.reset = this.reset.bind(this);\n    this.fromDataURL = this.fromDataURL.bind(this);\n  }\n\n  componentDidMount() {\n    // Listen to mouse up events from anywhere (not just the canvas)\n    document.addEventListener('mouseup', this.handleMouseUp);\n\n    this.velocityFilterWeight = this.props.velocityFilterWeight || 0.7;\n    this.minWidth = this.props.minWidth || 0.5;\n    this.maxWidth = this.props.maxWidth || 2.5;\n    this.throttle = this.props.throttle || 16; // in miliseconds\n    this.strokeMoveUpdate = this.throttle ? throttle(this.strokeUpdate, this.throttle) : this.strokeUpdate;\n    this.strokeMoveUpdate = this.strokeUpdate;\n    this.dotSize = this.props.dotSize || ((this.minWidth + this.maxWidth) / 2);\n    this.penColor = this.props.penColor || 'black';\n    this.backgroundColor = this.props.backgroundColor || 'rgba(0,0,0,0)';\n    this.mimeType = this.props.mimeType || 'image/png';\n    this.blob = this.props.blob || false;\n    this.trim = this.props.trim || false;\n    this.quality = this.props.quality || 1.0;\n\n    const canvas = this.canvas;\n    canvas.width = canvas.offsetWidth;\n    canvas.height = canvas.offsetHeight;\n    this.ctx = canvas.getContext('2d');\n    this.clear();\n  }\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.clear && nextProps.clear !== this.clearVal) {\n      this.clearVal = nextProps.clear;\n      this.clear();\n    }\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mouseup', this.handleMouseUp);\n  }\n\n  fromDataURL(dataUrl, options = {}, callback = null) {\n    this.reset();\n    const image = new Image();\n    const ratio = options.ratio || window.devicePixelRatio || 1;\n    const width = options.width || (this.canvas.width / ratio);\n    const height = options.height || (this.canvas.height / ratio);\n\n    image.onload = () => {\n      this.ctx.drawImage(image, 0, 0, width, height);\n      if (callback) { callback(); }\n    };\n    image.onerror = (error) => {\n      if (callback) { callback(error); }\n    };\n    image.src = dataUrl;\n  }\n\n  handleMouseDown(event) {\n    if (event.button === 0) {\n      this.mouseButtonDown = true;\n      this.strokeBegin(event);\n    }\n  }\n\n  handleMouseMove(event) {\n    if (this.mouseButtonDown) {\n      this.strokeMoveUpdate(event);\n    }\n  }\n\n  handleMouseUp(event) {\n    if (event.button === 0 && this.mouseButtonDown) {\n      this.mouseButtonDown = false;\n      this.strokeEnd(event);\n    }\n  }\n\n  handleTouchStart(event) {\n    if (event.targetTouches.length === 1) {\n      const touch = event.changedTouches[0];\n      this.strokeBegin(touch);\n    }\n  }\n\n  handleTouchMove(event) {\n    event.preventDefault();\n    const touch = event.targetTouches[0];\n    this.strokeMoveUpdate(touch);\n  }\n\n  handleTouchEnd(event) {\n    const wasCanvasTouched = event.target === this.canvas;\n    if (wasCanvasTouched) {\n      event.preventDefault();\n      this.strokeEnd(event);\n    }\n  }\n\n  strokeBegin(event) {\n    this.data.push([]);\n    this.reset();\n    this.strokeUpdate(event);\n\n    if (typeof this.props.onBegin === 'function') {\n      this.props.onBegin(event);\n    }\n  }\n\n  strokeUpdate(event) {\n    const x = event.clientX;\n    const y = event.clientY;\n\n    const point = this.createPoint(x, y);\n    const { curve, widths } = this.addPoint(point);\n\n    if (curve && widths) {\n      this.drawCurve(curve, widths.start, widths.end);\n    }\n\n    this.data[this.data.length - 1].push({\n      x: point.x,\n      y: point.y,\n      time: point.time\n    });\n  }\n\n  strokeEnd() {\n    const canDrawCurve = this.points.length > 2;\n    const point = this.points[0];\n\n    if (!canDrawCurve && point) {\n      this.drawDot(point);\n    }\n\n    if (typeof this.props.onEnd === 'function') {\n      this.props.onEnd(this.transformData());\n    }\n  }\n\n  transformData() {\n    let type = String(this.mimeType).toLowerCase();\n    let data;\n    let canvas;\n    if (this.trim) {\n      canvas = trim(this.canvas);\n    } else {\n      canvas = this.canvas;\n    }\n    if (type === 'image/jpeg' || 'image/png') {\n      data = canvas.toDataURL(type, this.quality);\n    } else {\n      type = 'image/png';\n      data = canvas.toDataURL(type, this.quality);\n    }\n    if (this.blob) {\n      // Not using toBlob since it's not supported by some browsers\n      const byteString = atob(data.split(',')[1]);\n      const mimeString = data.split(',')[0].split(':')[1].split(';')[0];\n      const array = new Uint8Array(byteString.length);\n      for (let i = 0; i < byteString.length; i += 1) {\n        array[i] = byteString.charCodeAt(i);\n      }\n      data = new Blob([array], { type: mimeString });\n    }\n    return data;\n  }\n\n  createPoint(x, y, time) {\n    const rect = this.canvas.getBoundingClientRect();\n\n    return new Point(\n      x - rect.left,\n      y - rect.top,\n      time || new Date().getTime()\n    );\n  }\n\n  addPoint(point) {\n    const points = this.points;\n    let tmp;\n    points.push(point);\n    if (points.length > 2) {\n      // To reduce the initial lag make it work with 3 points\n      // by copying the first point to the beginning.\n      if (points.length === 3) points.unshift(points[0]);\n      tmp = calculateCurveControlPoints(points[0], points[1], points[2]);\n      const c2 = tmp.c2;\n      tmp = calculateCurveControlPoints(points[1], points[2], points[3]);\n      const c3 = tmp.c1;\n      const curve = new Bezier(points[1], c2, c3, points[2]);\n      const widths = this.calculateCurveWidths(curve);\n      // Remove the first element from the list,\n      // so that we always have no more than 4 points in points array.\n      points.shift();\n      return { curve, widths };\n    }\n    return {};\n  }\n\n  calculateCurveWidths(curve) {\n    const startPoint = curve.startPoint;\n    const endPoint = curve.endPoint;\n    const widths = { start: null, end: null };\n\n    const velocity = (this.velocityFilterWeight * endPoint.velocityFrom(startPoint))\n      + ((1 - this.velocityFilterWeight) * this.lastVelocity);\n\n    const newWidth = this.strokeWidth(velocity);\n\n    widths.start = this.lastWidth;\n    widths.end = newWidth;\n\n    this.lastVelocity = velocity;\n    this.lastWidth = newWidth;\n\n    return widths;\n  }\n\n  strokeWidth(velocity) {\n    return Math.max(this.maxWidth / (velocity + 1), this.minWidth);\n  }\n\n  drawPoint(x, y, size) {\n    this.ctx.moveTo(x, y);\n    this.ctx.arc(x, y, size, 0, 2 * Math.PI, false);\n    if (typeof this.props.onChange === 'function') {\n      this.props.onChange(false);\n    }\n  }\n\n  drawCurve(curve, startWidth, endWidth) {\n    const widthDelta = endWidth - startWidth;\n    const drawSteps = Math.floor(curve.length());\n\n    this.ctx.beginPath();\n\n    for (let i = 0; i < drawSteps; i += 1) {\n      // Calculate the Bezier (x, y) coordinate for this step.\n      const t = i / drawSteps;\n      const tt = t * t;\n      const ttt = tt * t;\n      const u = 1 - t;\n      const uu = u * u;\n      const uuu = uu * u;\n\n      let x = uuu * curve.startPoint.x;\n      x += 3 * uu * t * curve.control1.x;\n      x += 3 * u * tt * curve.control2.x;\n      x += ttt * curve.endPoint.x;\n\n      let y = uuu * curve.startPoint.y;\n      y += 3 * uu * t * curve.control1.y;\n      y += 3 * u * tt * curve.control2.y;\n      y += ttt * curve.endPoint.y;\n\n      const width = startWidth + (ttt * widthDelta);\n      this.drawPoint(x, y, width);\n    }\n\n    this.ctx.closePath();\n    this.ctx.fill();\n  }\n\n  drawDot(point) {\n    this.ctx.beginPath();\n    this.drawPoint(point.x, point.y, this.dotSize);\n    this.ctx.closePath();\n    this.ctx.fill();\n  }\n\n  clear() {\n    this.ctx.fillStyle = this.backgroundColor;\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n\n    this.data = [];\n    this.reset();\n    if (typeof this.props.onChange === 'function') {\n      this.props.onChange(true);\n    }\n  }\n\n  reset() {\n    this.points = [];\n    this.lastVelocity = 0;\n    this.lastWidth = (this.minWidth + this.maxWidth) / 2;\n    this.ctx.fillStyle = this.penColor;\n  }\n\n  render() {\n    return (\n      <canvas\n        style={this.style}\n        className={this.props.className}\n        ref={(canvas) => { this.canvas = canvas; }}\n        onMouseDown={this.handleMouseDown}\n        onMouseMove={this.handleMouseMove}\n        onTouchStart={this.handleTouchStart}\n        onTouchMove={this.handleTouchMove}\n        onTouchEnd={this.handleTouchEnd}\n      />\n    );\n  }\n\n}\n\nexport default Signature;\n"]}